<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

	<div th:replace="common/header" />

	<body>
		<!-- WRAPPER -->
		<div id="wrapper">
			<!-- NAVBAR -->
			<div th:replace="common/navbar" />
			<!-- END NAVBAR -->
			<!-- LEFT SIDEBAR -->
			<div th:replace="common/sidebar" />
			<!-- END LEFT SIDEBAR -->
			<!-- MAIN -->
			<div class="main">
				<!-- MAIN CONTENT -->
				<div class="main-content">
					<div class="container-fluid">
						<h3 class="page-title">트래픽 관리</h3>
						<div class="row">
							<div class="col-md-12">
								<!-- TABLE STRIPED -->
								<div class="panel">
									<div class="panel-heading">
										<h3 class="panel-title">주문 내역</h3>
										<br>
										<select id="vendorSelect" class="form-control" onchange="selectVendor(this)">
											<option value="KINGS">KINGS</option>
											<option value="JAP">JAP</option>
										</select>
									</div>
									<div class="panel-body table-responsive">
										<div class="input-group md-3 search-float-right">
											<input class="form-control" type="text">
											<span class="input-group-btn"><button class="btn btn-primary" type="button">검색</button></span>
										</div>
										<br>
										<br>
										<br>
										<table class="table table-striped table-hover order-table-header">
											<thead>
											<tr>
												<th name="no">넘버</th>
												<th name="orderId">주문번호</th>
												<th name="orderAction">주문타입</th>
												<th name="service">서비스번호</th>
												<th name="link">링크</th>
												<th name="runs">반복개수</th>
												<th name="orderInterval">반복주기</th>
												<th name="charge">금액</th>
												<th name="quantity">주문개수</th>
												<th name="remains">남은개수</th>
												<th name="status">상태</th>
												<th name="regDate">생성일자</th>
											</tr>
											</thead>
											<tbody>
												<tr>
													<td id="loading" colspan="12" style="text-align: center">
														<i class="fa fa-refresh fa-spin"></i>
														loading...
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
								<!-- END TABLE STRIPED -->
							</div>
						</div>
					</div>
				</div>
				<!-- END MAIN CONTENT -->
			</div>
			<!-- END MAIN -->
			<div class="clearfix"></div>
			<footer>
				<div class="container-fluid">
					<p class="copyright">Shared by <i class="fa fa-love"></i><a href="https://bootstrapthemes.co">BootstrapThemes</a>
	</p>
				</div>
			</footer>
		</div>
		<!-- END WRAPPER -->
		<!-- Javascript -->
		<script src="/vendor/jquery/jquery.min.js"></script>
		<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
		<script src="/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
		<script src="/scripts/klorofil-common.js"></script>
		<script src="/scripts/custom.js"></script>
		<script>
			$(document).ready(function() {
				myRequests("/traffic/orderList", {"vendor":"JAP"}, "POST", getOrderList);
			});

			/**
			 * 주문 리스트 콜백 함수
			 */
			function getOrderList(data) {
				const res = JSON.parse(data.response);
				let $tbody = document.getElementsByTagName('tbody')[0];
				let $th = document.getElementsByTagName('th');
				for (let i=0, ll=data.list.length; i<ll; i++) {
					console.log("list["+i+"] : ", data.list[i]);
					console.log("response["+data.list[i]["orderId"]+"] : ", res[data.list[i]['orderId']]);
					console.log("response["+data.list[i]["orderId"]+"][charge] : ", res[data.list[i]['orderId']]['charge']);

					const keys = Object.keys(data.list[i]);
					console.log("keys : ", keys);
					let $tr = document.createElement('tr');
					for (let j=0, jl=$th.length; j<jl; j++) {
						let $td = document.createElement('td');
						let _name = $th[j].getAttribute('name');
						if (_name === 'no') $td.innerText = String(i+1);
						else if (keys.includes(_name)) $td.innerText = data.list[i][_name];
						else if (res[data.list[i]['orderId']][_name] != undefined) $td.innerText = res[data.list[i]['orderId']][_name];
						else $td.innerText = '-';
						$tr.appendChild($td);
					}
					$tbody.appendChild($tr);
				}
			}
		</script>
	</body>

</html>
