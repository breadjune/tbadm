<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.metaboss.repository.OrderRepository">

    <select id="getOrder" parameterType="kr.co.metaboss.dto.common.Search" resultType="kr.co.metaboss.vo.OrderVO">
        SELECT *
        FROM TB_ORDER
        WHERE vendor = #{vendor}
        <if test="keyword != ''">
            AND (
                orderId LIKE CONCAT( '%', #{keyword}, '%' )
             OR service LIKE CONCAT( '%', #{keyword}, '%' )
             OR link LIKE CONCAT( '%', #{keyword}, '%' )
             OR quantity LIKE CONCAT( '%', #{keyword}, '%' )
             OR runs LIKE CONCAT( '%', #{keyword}, '%' )
             OR orderInterval LIKE CONCAT( '%', #{keyword}, '%' )
             OR regDate LIKE CONCAT( '%', #{keyword}, '%' )
            )
        </if>
        <if test="sortColumn != ''">
            ORDER BY #{sortColumn} #{sortType}
        </if>
        LIMIT ${offset}, ${recodeSize}
    </select>

    <select id="getOrderCount" parameterType="kr.co.metaboss.dto.common.Search" resultType="String">
        SELECT count(*)
        FROM TB_ORDER
        WHERE vendor = #{vendor}
        <if test="keyword != ''">
            AND (
            orderId LIKE CONCAT( '%', #{keyword}, '%' )
            OR service LIKE CONCAT( '%', #{keyword}, '%' )
            OR link LIKE CONCAT( '%', #{keyword}, '%' )
            OR quantity LIKE CONCAT( '%', #{keyword}, '%' )
            OR runs LIKE CONCAT( '%', #{keyword}, '%' )
            OR orderInterval LIKE CONCAT( '%', #{keyword}, '%' )
            OR regDate LIKE CONCAT( '%', #{keyword}, '%' )
            )
        </if>
    </select>

    <insert id="insertOrder" parameterType="kr.co.metaboss.dto.traffic.Order">
        INSERT INTO TB_ORDER (
            orderId
        ,   vendor
        ,   orderAction
        ,   service
        ,   link
        ,   quantity
        ,   runs
        ,   orderInterval
        ,   regDate
        ) VALUES
        (
            #{orderId}
        ,   #{vendor}
        ,   #{action}
        ,   #{service}
        ,   #{link}
        ,   #{quantity}
        ,   #{runs}
        ,   #{interval}
        ,   NOW()
        )
    </insert>
</mapper>